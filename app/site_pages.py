from fastapi import APIRouter
from fastapi.responses import HTMLResponse


router = APIRouter(tags=["site"])


def _layout(title: str, body: str) -> str:
    return f"""<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{title}</title>
  <style>
    :root {{
      --bg: #f7f9fc;
      --card: #ffffff;
      --text: #17212b;
      --muted: #5b6875;
      --accent: #0e7a4b;
      --line: #e5e9f0;
    }}
    * {{ box-sizing: border-box; }}
    body {{
      margin: 0;
      padding: 24px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(180deg, #f7f9fc 0%, #eef3f8 100%);
      color: var(--text);
    }}
    .wrap {{
      max-width: 920px;
      margin: 0 auto;
    }}
    .card {{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 24px;
      box-shadow: 0 8px 32px rgba(17, 24, 39, 0.05);
    }}
    h1, h2 {{ margin-top: 0; }}
    p, li {{ line-height: 1.55; }}
    .muted {{ color: var(--muted); }}
    nav {{
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }}
    a {{
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }}
    a:hover {{ text-decoration: underline; }}
    .ok {{
      border-left: 4px solid var(--accent);
      background: #f0fbf5;
      padding: 12px 14px;
      border-radius: 8px;
    }}
  </style>
</head>
<body>
  <div class="wrap">
    <nav>
      <a href="/">Главная</a>
      <a href="/contacts">Контакты</a>
      <a href="/offer">Оферта</a>
      <a href="/privacy">Политика ПДн</a>
      <a href="/refund">Возврат</a>
    </nav>
    <div class="card">
      {body}
      <hr />
      <p class="muted">
        Служба поддержки: maxvinnie@mail.ru, телефон: 89990222389, РФ, г. Санкт-Петербург.<br/>
        Часы поддержки: Пн-Пт, 10:00-19:00 МСК.
      </p>
    </div>
  </div>
</body>
</html>"""


@router.get("/", response_class=HTMLResponse)
async def home() -> str:
    return _layout(
        "Автоприем оплат в Telegram-боте",
        """
        <h1>Автоприем денег в Telegram-боте</h1>
        <p>Подключаем оплату картой и СБП в Telegram-боте с автоматической выдачей доступа.</p>
        <h2>Что получает клиент</h2>
        <ul>
          <li>Прием оплат 24/7 через Lava.</li>
          <li>Webhook-обработку статусов платежей.</li>
          <li>Автоматическую активацию/продление подписки.</li>
          <li>Уведомления пользователю об успешной оплате.</li>
        </ul>
        <h2>Тарифы</h2>
        <ul>
          <li><b>BASIC</b>: $149 (разовая оплата).</li>
          <li><b>PRO</b>: $249 (подписки + уведомления).</li>
          <li><b>CUSTOM</b>: $349 (индивидуальная интеграция).</li>
        </ul>
        <p class="muted">Оплата производится в рублях по курсу на момент оплаты. Условия оказания услуги и оплаты указаны в публичной оферте.</p>
        """,
    )


@router.get("/contacts", response_class=HTMLResponse)
async def contacts() -> str:
    return _layout(
        "Контакты",
        """
        <h1>Контакты</h1>
        <p><b>Email:</b> maxvinnie@mail.ru</p>
        <p><b>Телефон:</b> 89990222389</p>
        <p><b>Город:</b> Санкт-Петербург, РФ</p>
        <p><b>Служба поддержки:</b> Пн-Пт, 10:00-19:00 МСК</p>
        """,
    )


@router.get("/offer", response_class=HTMLResponse)
async def offer() -> str:
    return _layout(
        "Публичная оферта",
        """
        <h1>Публичная оферта</h1>
        <p>Настоящий документ является предложением заключить договор на оказание услуг в электронном виде.</p>
        <h2>1. Общие положения</h2>
        <p>Исполнитель оказывает услуги по настройке и внедрению автоматической оплаты в Telegram-бот Заказчика. Оплата предоплаты означает принятие условий оферты.</p>
        <h2>2. Стоимость и оплата</h2>
        <ul>
          <li>BASIC — $149 (разовая оплата).</li>
          <li>PRO — $249 (подписки + уведомления).</li>
          <li>CUSTOM — $349 (индивидуальная интеграция).</li>
        </ul>
        <p>Предоплата: 50% от стоимости тарифа. Остаток: 50% после сдачи работы. Оплата производится в рублях.</p>
        <h2>3. Сроки выполнения</h2>
        <p>Стандартный срок: 3-5 рабочих дней с момента получения предоплаты и всех доступов. Срок может быть увеличен по согласованию сторон.</p>
        <h2>4. Что входит в услугу</h2>
        <ul>
          <li>Настройка платежной системы (Lava).</li>
          <li>Настройка webhook для автообработки платежей.</li>
          <li>Выдача доступа после оплаты (подписка или разовая).</li>
          <li>Уведомления об оплате.</li>
          <li>Деплой на сервер.</li>
          <li>Базовая инструкция для владельца.</li>
          <li>14 дней гарантии на исправление багов.</li>
        </ul>
        <h2>5. Не включено</h2>
        <ul>
          <li>Переписывание логики существующего бота.</li>
          <li>Разработка нового функционала бота.</li>
          <li>CRM-системы и сложная аналитика.</li>
          <li>Маркетинг и продвижение.</li>
          <li>Кастомные веб-панели и админки.</li>
          <li>Интеграция со сторонними сервисами (кроме оговоренных).</li>
        </ul>
        <h2>6. Требования к заказчику</h2>
        <p>Заказчик предоставляет токен Telegram-бота, доступы к Lava, доступ к серверу (или согласует хостинг), тексты, цены и тарифы. Задержка доступа продлевает срок сдачи.</p>
        <h2>7. Техподдержка</h2>
        <p>Гарантия: 14 дней после сдачи (исправление багов бесплатно). После гарантии: поддержка за $30-50/мес. В поддержку не входит новый функционал и изменение логики.</p>
        <h2>8. Ответственность</h2>
        <p>Исполнитель не несет ответственности за блокировки Telegram, проблемы на стороне Lava, действия третьих лиц и потерю доходов Заказчика из-за простоев. Исполнитель обязуется соблюдать конфиденциальность.</p>
        <h2>9. Возврат средств</h2>
        <p>Предоплата не возвращается после начала работы. Если Исполнитель не выполнил работу в срок, возврат — 100% предоплаты. Если Заказчик отказался после начала работы, предоплата не возвращается.</p>
        <h2>10. Прочие условия</h2>
        <p>Все договоренности фиксируются в переписке Telegram. Изменения ТЗ обсуждаются отдельно и могут влиять на стоимость. Хостинг сервера оплачивается отдельно или включается в поддержку.</p>
        <h2>11. Контакты</h2>
        <p>Email: maxvinnie@mail.ru. Город: Санкт-Петербург, РФ.</p>
        """,
    )


@router.get("/privacy", response_class=HTMLResponse)
async def privacy() -> str:
    return _layout(
        "Политика обработки персональных данных",
        """
        <h1>Политика обработки персональных данных</h1>
        <p>Оператор персональных данных: Исполнитель услуг по подключению платежной системы в Telegram-ботах (город: Санкт-Петербург, РФ, email: maxvinnie@mail.ru).</p>
        <p>Мы обрабатываем персональные данные в объеме, необходимом для оказания услуг и приема оплаты.</p>
        <h2>Какие данные обрабатываются</h2>
        <ul>
          <li>Контактные данные клиента (email, телефон).</li>
          <li>Идентификаторы пользователя в Telegram.</li>
          <li>Технические данные, связанные с оплатой заказа.</li>
        </ul>
        <h2>Цели обработки</h2>
        <ul>
          <li>Оказание услуги и поддержка клиента.</li>
          <li>Проведение и учет платежей.</li>
          <li>Выполнение требований законодательства РФ.</li>
        </ul>
        <h2>Срок хранения</h2>
        <p>Данные хранятся в течение срока, необходимого для оказания услуги, исполнения обязательств и соблюдения требований законодательства РФ.</p>
        <h2>Права субъекта персональных данных</h2>
        <p>Клиент может направить запрос на уточнение или удаление данных по email: maxvinnie@mail.ru.</p>
        """,
    )


@router.get("/refund", response_class=HTMLResponse)
async def refund() -> str:
    return _layout(
        "Условия возврата и отмены платежа",
        """
        <h1>Условия возврата и отмены платежа</h1>
        <h2>Отмена услуги</h2>
        <p>До начала оказания услуги клиент может отменить заказ, направив обращение в поддержку.</p>
        <h2>Возврат средств</h2>
        <p>Предоплата не возвращается после начала работы.</p>
        <p>Если Исполнитель не выполнил работу в срок — возврат 100% предоплаты.</p>
        <p>Если Заказчик отказался от работы после начала — предоплата не возвращается.</p>
        <p>При подтверждении возврата заявка рассматривается до 10 рабочих дней, средства возвращаются тем же способом, которым была произведена оплата.</p>
        <h2>Доставка</h2>
        <p>Услуга оказывается в цифровом формате, физическая доставка не применяется.</p>
        <h2>Контакты по возвратам</h2>
        <p>Email: maxvinnie@mail.ru, город: Санкт-Петербург, РФ, телефон: 89990222389.</p>
        """,
    )


@router.get("/pay/success", response_class=HTMLResponse)
async def payment_success() -> str:
    return _layout(
        "Оплата успешно завершена",
        """
        <h1>Оплата прошла успешно</h1>
        <div class="ok">Платеж принят. Доступ будет активирован автоматически после обработки webhook.</div>
        <p>Если доступ не открылся в течение 5 минут, напишите в поддержку.</p>
        """,
    )


@router.get("/pay/fail", response_class=HTMLResponse)
async def payment_fail() -> str:
    return _layout(
        "Оплата не завершена",
        """
        <h1>Оплата не завершена</h1>
        <p>Платеж был отменен или не прошел.</p>
        <p>Попробуйте повторить оплату в боте или обратитесь в поддержку.</p>
        """,
    )
